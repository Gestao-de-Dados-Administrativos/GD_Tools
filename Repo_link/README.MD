# Sistema Unificado de Integra√ß√£o com Reposit√≥rio CAED

Sistema refatorado e unificado para integra√ß√£o com o Reposit√≥rio CAED, suportando os ambientes Central e CPD.

## üìã Caracter√≠sticas

- ‚úÖ Unifica√ß√£o dos scripts `repo_link_central.py` e `repo_link_cpd.py`
- ‚úÖ C√≥digo refatorado e organizado com classes
- ‚úÖ Configura√ß√µes movidas para arquivo `.env`
- ‚úÖ Suporte a m√∫ltiplos ambientes (Central e CPD)
- ‚úÖ Melhor tratamento de erros
- ‚úÖ Documenta√ß√£o completa
- ‚úÖ Type hints para melhor IDE support

## üöÄ Instala√ß√£o

1. **Clone ou baixe o projeto**

2. **Instale as depend√™ncias:**
```bash
pip install -r requirements.txt
```

3. **Configure o arquivo .env:**
```bash
cp .env.example .env
```

4. **Edite o arquivo .env com suas credenciais:**
```env
# Escolha o ambiente: 'central' ou 'cpd'
AMBIENTE=central

# Configure as credenciais de cada ambiente
CENTRAL_ID_USER=seu_id
CENTRAL_USER=seu_usuario
CENTRAL_SENHA=sua_senha
CENTRAL_BASE_URL=https://repositorio.caeddigital.net

CPD_ID_USER=seu_id
CPD_USER=seu_usuario
CPD_SENHA=sua_senha
CPD_BASE_URL=http://10.0.10.22:41112
```

## üíª Uso

### Exemplo B√°sico

```python
from repo_link import RepositorioCAED

# Cria inst√¢ncia
repo = RepositorioCAED()

# Autentica (autom√°tico na primeira requisi√ß√£o)
token = repo.autenticar()
print(f"Autenticado com sucesso!")

# Baixa dados
caminho = repo.baixar_dado_adm(
    formulario='ESCOLA',
    subprograma='SEU_SUBPROGRAMA',
    fonte='SUA_FONTE',
    destino='downloads'
)
print(f"Arquivo salvo em: {caminho}")
```

### Mudando de Ambiente

Para alternar entre ambientes, basta mudar a vari√°vel `AMBIENTE` no arquivo `.env`:

```env
# Para ambiente Central
AMBIENTE=central

# Para ambiente CPD
AMBIENTE=cpd
```

### Uso com Filtros

```python
# Baixa com filtro
caminho = repo.baixar_dado_adm(
    formulario='ESCOLA',
    subprograma='SEU_SUBPROGRAMA',
    fonte='SUA_FONTE',
    destino='downloads',
    filtro_coluna='TP_DEPENDENCIA_ADMINISTRATIVA',
    filtro_op='=',
    filtro_valor='1'
)
```

### Operadores de Filtro Dispon√≠veis

- `=` : Igual a
- `in` : Pertence a (use lista ou string separada por `|||`)

Exemplo com `in`:
```python
# Usando lista
filtro_valor = ['1', '2', '3']

# Ou usando string
filtro_valor = '1|||2|||3'
```

## üìö Formul√°rios Suportados

O sistema suporta os seguintes formul√°rios:

- **L185**: Leiaute de Usu√°rio - v3
- **L062**: Leiaute de Controle de usu√°rios e pontos de entrega
- **L204**: Leiaute de Instrumento
- **L005**: Leiaute de base planejada
- **L009**: Leiaute de sujeito
- **L008**: Leiaute de item
- **Formul√°rios AD**: Qualquer formul√°rio administrativo

## üîß Fun√ß√µes Auxiliares

### Valida√ß√£o de CPF

```python
from repo_link import cpf_validator

if cpf_validator('12345678900'):
    print("CPF v√°lido!")
else:
    print("CPF inv√°lido!")
```

### Gerar C√≥digo √önico

```python
from repo_link import gerar_codigo_unico

codigo = gerar_codigo_unico(tamanho=12)
print(f"C√≥digo gerado: {codigo}")
```

## üìÅ Estrutura de Arquivos

```
.
‚îú‚îÄ‚îÄ repo_link.py          # Script principal unificado
‚îú‚îÄ‚îÄ requirements.txt      # Depend√™ncias do projeto
‚îú‚îÄ‚îÄ .env                  # Configura√ß√µes (n√£o versionar!)
‚îú‚îÄ‚îÄ .env.example         # Exemplo de configura√ß√µes
‚îî‚îÄ‚îÄ README.md            # Esta documenta√ß√£o
```

## üîí Seguran√ßa

‚ö†Ô∏è **IMPORTANTE**: 
- Nunca versione o arquivo `.env` com credenciais reais
- Adicione `.env` ao seu `.gitignore`
- Use o `.env.example` apenas como template

Exemplo de `.gitignore`:
```
.env
*.csv
downloads/
__pycache__/
*.pyc
```

## üÜï Mudan√ßas em Rela√ß√£o aos Scripts Antigos

### Antes (repo_link_central.py / repo_link_cpd.py)

```python
# Credenciais em CSV
cadastro = pd.read_csv('acesso.csv')

# Duas vers√µes do script
# URL hardcoded no c√≥digo
```

### Agora (repo_link.py)

```python
# Credenciais no .env
# Script √∫nico
# Configura√ß√£o por ambiente
# Melhor organiza√ß√£o com classes
```

### Migra√ß√£o do C√≥digo Antigo

Se voc√™ tem c√≥digo usando as fun√ß√µes antigas, elas ainda funcionam:

```python
# C√≥digo antigo (ainda funciona)
from repo_link import consulta_cadastro, get_bearer_token

cadastro = consulta_cadastro()  # Retorna DataFrame com config atual

# C√≥digo novo (recomendado)
from repo_link import RepositorioCAED

repo = RepositorioCAED()
token = repo.autenticar()
```

## üêõ Solu√ß√£o de Problemas

### Erro: "Configura√ß√µes incompletas"
- Verifique se todas as vari√°veis no `.env` est√£o preenchidas
- Confirme que o arquivo `.env` est√° no mesmo diret√≥rio do script

### Erro de autentica√ß√£o
- Verifique se as credenciais est√£o corretas
- Confirme se est√° usando o ambiente correto (central/cpd)

### Timeout no download
- O tempo limite padr√£o √© 600 segundos (10 minutos)
- Arquivos muito grandes podem demorar mais
- Verifique sua conex√£o com o servidor

## üìù Exemplo Completo

```python
from repo_link import RepositorioCAED
import os

def main():
    # Inicializa o reposit√≥rio
    repo = RepositorioCAED()
    
    print(f"Ambiente configurado: {repo.config.ambiente}")
    print(f"URL base: {repo.config.base_url}")
    
    # Autentica
    print("Autenticando...")
    repo.autenticar()
    print("‚úì Autenticado com sucesso!")
    
    # Baixa m√∫ltiplos formul√°rios
    formularios = ['ESCOLA', 'TURMA', 'ALUNO']
    
    for form in formularios:
        print(f"\n{'='*50}")
        print(f"Baixando: {form}")
        print('='*50)
        
        try:
            caminho = repo.baixar_dado_adm(
                formulario=form,
                subprograma='SEU_PROGRAMA',
                fonte='SUA_FONTE',
                destino='downloads'
            )
            
            if caminho:
                print(f"‚úì Sucesso! Arquivo: {caminho}")
                
                # Verifica tamanho do arquivo
                tamanho = os.path.getsize(caminho) / (1024*1024)  # MB
                print(f"  Tamanho: {tamanho:.2f} MB")
            else:
                print(f"‚úó Falha ao baixar {form}")
                
        except Exception as e:
            print(f"‚úó Erro: {str(e)}")
    
    print("\n‚úì Processo conclu√≠do!")

if __name__ == "__main__":
    main()
```

## üìû Suporte

Para d√∫vidas ou problemas:
1. Verifique a documenta√ß√£o acima
2. Consulte os exemplos de uso
3. Verifique as mensagens de erro detalhadas no console

## üìÑ Licen√ßa

Este √© um projeto interno CAED.